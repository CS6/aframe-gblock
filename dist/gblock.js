// https://github.com/archilogic-com/aframe-gblock
(function () {
	'use strict';

	var fsBase64 = "data:text/plain;base64,cHJlY2lzaW9uIGhpZ2hwIGZsb2F0Owpjb25zdCBmbG9hdCBJTlZfUEkgPSAwLjMxODMwOTg4NjE4Owpjb25zdCBmbG9hdCBQSSA9IDMuMTQxNTkyNjU0Owpjb25zdCBmbG9hdCBfUmVmcmFjdGl2ZUluZGV4ID0gMS4yOwpjb25zdCBmbG9hdCBlbnZpcm9ubWVudFN0cmVuZ3RoID0gMS41Owp2YXJ5aW5nIHZlYzMgdl9ub3JtYWw7CnZhcnlpbmcgdmVjMyB2X3Bvc2l0aW9uOwp2YXJ5aW5nIHZlYzMgdl9iaW5vcm1hbDsKdmFyeWluZyB2ZWMzIHZfdGFuZ2VudDsKdW5pZm9ybSB2ZWMzIHVfY29sb3I7CnVuaWZvcm0gZmxvYXQgdV9tZXRhbGxpYzsKdW5pZm9ybSBmbG9hdCB1X3JvdWdobmVzczsKdW5pZm9ybSB2ZWMzIHVfbGlnaHQwUG9zOwp1bmlmb3JtIHZlYzMgdV9saWdodDBDb2xvcjsKdW5pZm9ybSB2ZWMzIHVfbGlnaHQxUG9zOwp1bmlmb3JtIHZlYzMgdV9saWdodDFDb2xvcjsKdW5pZm9ybSBtYXQ0IHVfbW9kZWxNYXRyaXg7CnVuaWZvcm0gc2FtcGxlcjJEIHVfcmVmbGVjdGlvbkN1YmU7CnVuaWZvcm0gc2FtcGxlcjJEIHVfcmVmbGVjdGlvbkN1YmVCbHVyOwpjb25zdCBmbG9hdCB1X25vaXNlSW50ZW5zaXR5ID0gMC4wMTU7CmNvbnN0IGZsb2F0IGNvbG9yTm9pc2VBbW91bnQgPSAwLjAxNTsKY29uc3QgZmxvYXQgbm9pc2VTY2FsZSA9IDcwMC4wOwp1bmlmb3JtIHZlYzMgY2FtZXJhUG9zaXRpb247CnZlYzMgbW9kMjg5KHZlYzMgeCkgewogIHJldHVybiB4IC0gZmxvb3IoeCAqICgxLjAgLyAyODkuMCkpICogMjg5LjA7Cn0KdmVjNCBtb2QyODkodmVjNCB4KSB7CiAgcmV0dXJuIHggLSBmbG9vcih4ICogKDEuMCAvIDI4OS4wKSkgKiAyODkuMDsKfQp2ZWM0IHBlcm11dGUodmVjNCB4KSB7CiAgICAgcmV0dXJuIG1vZDI4OSgoKHgqMzQuMCkrMS4wKSp4KTsKfQp2ZWM0IHRheWxvckludlNxcnQodmVjNCByKQp7CiAgcmV0dXJuIDEuNzkyODQyOTE0MDAxNTkgLSAwLjg1MzczNDcyMDk1MzE0ICogcjsKfQpmbG9hdCBzbm9pc2UodmVjMyB2LCBvdXQgdmVjMyBncmFkaWVudCkKewogIGNvbnN0IHZlYzIgIEMgPSB2ZWMyKDEuMC82LjAsIDEuMC8zLjApIDsKICBjb25zdCB2ZWM0ICBEID0gdmVjNCgwLjAsIDAuNSwgMS4wLCAyLjApOwogIHZlYzMgaSAgPSBmbG9vcih2ICsgZG90KHYsIEMueXl5KSApOwogIHZlYzMgeDAgPSAgIHYgLSBpICsgZG90KGksIEMueHh4KSA7CiAgdmVjMyBnID0gc3RlcCh4MC55engsIHgwLnh5eik7CiAgdmVjMyBsID0gMS4wIC0gZzsKICB2ZWMzIGkxID0gbWluKCBnLnh5eiwgbC56eHkgKTsKICB2ZWMzIGkyID0gbWF4KCBnLnh5eiwgbC56eHkgKTsKICB2ZWMzIHgxID0geDAgLSBpMSArIEMueHh4OwogIHZlYzMgeDIgPSB4MCAtIGkyICsgQy55eXk7ICB2ZWMzIHgzID0geDAgLSBELnl5eTsKICBpID0gbW9kMjg5KGkpOwogIHZlYzQgcCA9IHBlcm11dGUoIHBlcm11dGUoIHBlcm11dGUoCiAgICAgICAgICAgICBpLnogKyB2ZWM0KDAuMCwgaTEueiwgaTIueiwgMS4wICkpCiAgICAgICAgICAgKyBpLnkgKyB2ZWM0KDAuMCwgaTEueSwgaTIueSwgMS4wICkpCiAgICAgICAgICAgKyBpLnggKyB2ZWM0KDAuMCwgaTEueCwgaTIueCwgMS4wICkpOwogIGZsb2F0IG5fID0gMC4xNDI4NTcxNDI4NTc7ICB2ZWMzICBucyA9IG5fICogRC53eXogLSBELnh6eDsKICB2ZWM0IGogPSBwIC0gNDkuMCAqIGZsb29yKHAgKiBucy56ICogbnMueik7CiAgdmVjNCB4XyA9IGZsb29yKGogKiBucy56KTsKICB2ZWM0IHlfID0gZmxvb3IoaiAtIDcuMCAqIHhfICk7CiAgdmVjNCB4ID0geF8gKm5zLnggKyBucy55eXl5OwogIHZlYzQgeSA9IHlfICpucy54ICsgbnMueXl5eTsKICB2ZWM0IGggPSAxLjAgLSBhYnMoeCkgLSBhYnMoeSk7CiAgdmVjNCBiMCA9IHZlYzQoIHgueHksIHkueHkgKTsKICB2ZWM0IGIxID0gdmVjNCggeC56dywgeS56dyApOwogIHZlYzQgczAgPSBmbG9vcihiMCkqMi4wICsgMS4wOwogIHZlYzQgczEgPSBmbG9vcihiMSkqMi4wICsgMS4wOwogIHZlYzQgc2ggPSAtc3RlcChoLCB2ZWM0KDAuMCkpOwogIHZlYzQgYTAgPSBiMC54enl3ICsgczAueHp5dypzaC54eHl5IDsKICB2ZWM0IGExID0gYjEueHp5dyArIHMxLnh6eXcqc2guenp3dyA7CiAgdmVjMyBwMCA9IHZlYzMoYTAueHksaC54KTsKICB2ZWMzIHAxID0gdmVjMyhhMC56dyxoLnkpOwogIHZlYzMgcDIgPSB2ZWMzKGExLnh5LGgueik7CiAgdmVjMyBwMyA9IHZlYzMoYTEuencsaC53KTsKICB2ZWM0IG5vcm0gPSB0YXlsb3JJbnZTcXJ0KHZlYzQoZG90KHAwLHAwKSwgZG90KHAxLHAxKSwgZG90KHAyLCBwMiksIGRvdChwMyxwMykpKTsKICBwMCAqPSBub3JtLng7CiAgcDEgKj0gbm9ybS55OwogIHAyICo9IG5vcm0uejsKICBwMyAqPSBub3JtLnc7CiAgdmVjNCBtID0gbWF4KDAuNiAtIHZlYzQoZG90KHgwLHgwKSwgZG90KHgxLHgxKSwgZG90KHgyLHgyKSwgZG90KHgzLHgzKSksIDAuMCk7CiAgdmVjNCBtMiA9IG0gKiBtOwogIHZlYzQgbTQgPSBtMiAqIG0yOwogIHZlYzQgcGRvdHggPSB2ZWM0KGRvdChwMCx4MCksIGRvdChwMSx4MSksIGRvdChwMix4MiksIGRvdChwMyx4MykpOwogIHZlYzQgdGVtcCA9IG0yICogbSAqIHBkb3R4OwogIGdyYWRpZW50ID0gLTguMCAqICh0ZW1wLnggKiB4MCArIHRlbXAueSAqIHgxICsgdGVtcC56ICogeDIgKyB0ZW1wLncgKiB4Myk7CiAgZ3JhZGllbnQgKz0gbTQueCAqIHAwICsgbTQueSAqIHAxICsgbTQueiAqIHAyICsgbTQudyAqIHAzOwogIGdyYWRpZW50ICo9IDQyLjA7CiAgcmV0dXJuIDQyLjAgKiBkb3QobTQsIHBkb3R4KTsKfQpmbG9hdCBHR1goZmxvYXQgbkRvdEgsIGZsb2F0IHJvdWdobmVzczIpIHsKICBmbG9hdCBuRG90SDIgPSBuRG90SCAqIG5Eb3RIOwogIGZsb2F0IGFscGhhID0gbkRvdEgyICogcm91Z2huZXNzMiArIDEuMCAtIG5Eb3RIMjsKICBmbG9hdCBkZW5vbWluYXRvciA9IFBJICogYWxwaGEgKiBhbHBoYTsKICByZXR1cm4gKG5Eb3RIMiA+IDAuMCA/IDEuMCA6IDAuMCkgKiByb3VnaG5lc3MyIC8gZGVub21pbmF0b3I7Cn0KZmxvYXQgQmxpbm5QaG9uZ05ERihmbG9hdCBuRG90SCkgewogIGZsb2F0IGV4cG9uZW50ID0gKDIuMCAvICh1X3JvdWdobmVzcyAqIHVfcm91Z2huZXNzKSAtIDIuMCk7CiAgZmxvYXQgY29lZmYgPSAxLjAgLyAoUEkgKiB1X3JvdWdobmVzcyAqIHVfcm91Z2huZXNzKTsKICByZXR1cm4gY29lZmYgKiBwb3cobkRvdEgsIGV4cG9uZW50KTsKfQpmbG9hdCBDVF9HZW9BdHRlbihmbG9hdCBuRG90ViwgZmxvYXQgbkRvdEgsIGZsb2F0IHZEb3RILCBmbG9hdCBuRG90TCwgZmxvYXQgbERvdEgpIHsKICBmbG9hdCBhID0gKDIuMCAqIG5Eb3RIICogbkRvdFYpIC8gdkRvdEg7CiAgZmxvYXQgYiA9ICgyLjAgKiBuRG90SCAqIG5Eb3RMKSAvIGxEb3RIOwogIHJldHVybiBtaW4oMS4wLCBtaW4oYSwgYikpOwp9CmZsb2F0IEdlb0F0dGVuKGZsb2F0IG5Eb3RWKSB7CiBmbG9hdCBjID0gbkRvdFYgLyAodV9yb3VnaG5lc3MgKiBzcXJ0KDEuMCAtIG5Eb3RWICogbkRvdFYpKTsKIHJldHVybiBjID49IDEuNiA/IDEuMCA6CiAgICAgKDMuNTM1ICogYyArIDIuMTgxICogYyAqIGMpIC8gKDEuMCArIDIuMjc2ICogYyArIDIuNTc3ICogYyAqIGMpOwp9CnZlYzMgZXZhbHVhdGVGcmVzbmVsU2NobGljayhmbG9hdCB2RG90SCwgdmVjMyBmMCkgewogIHJldHVybiBmMCArICgxLjAgLSBmMCkgKiBwb3coMS4wIC0gdkRvdEgsIDUuMCk7Cn0KZmxvYXQgc2F0dXJhdGUoZmxvYXQgdmFsdWUpIHsKICByZXR1cm4gY2xhbXAodmFsdWUsIDAuMCwgMS4wKTsKfQp2ZWMzIHNhdHVyYXRlKHZlYzMgdmFsdWUpIHsKICByZXR1cm4gY2xhbXAodmFsdWUsIDAuMCwgMS4wKTsKfQptYXQzIHRyYW5zcG9zZShtYXQzIGluTWF0KSB7CiAgcmV0dXJuIG1hdDMoaW5NYXRbMF1bMF0sIGluTWF0WzBdWzFdLCBpbk1hdFswXVsyXSwKICAgICAgICAgICAgICBpbk1hdFsxXVswXSwgaW5NYXRbMV1bMV0sIGluTWF0WzFdWzJdLAogICAgICAgICAgICAgIGluTWF0WzJdWzBdLCBpbk1hdFsyXVsxXSwgaW5NYXRbMl1bMl0pOwp9CnZvaWQgZ2VuZXJhdGVQYXBlcmNyYWZ0Q29sb3JOb3JtYWwodmVjMyBub3JtYWwsIHZlYzMgdGFuZ2VudCwgdmVjMyBiaW5vcm1hbCwgdmVjMyBub2lzZVBvcywgaW5vdXQgdmVjNCBvdXRDb2xvck11bHQsIGlub3V0IHZlYzMgb3V0Tm9ybWFsKSB7CiAgbWF0MyB0YW5nZW50VG9PYmplY3Q7CiAgdGFuZ2VudFRvT2JqZWN0WzBdID0gdmVjMyh0YW5nZW50LngsIHRhbmdlbnQueSwgdGFuZ2VudC56KTsKICB0YW5nZW50VG9PYmplY3RbMV0gPSB2ZWMzKGJpbm9ybWFsLngsIGJpbm9ybWFsLnksIGJpbm9ybWFsLnopOwogIHRhbmdlbnRUb09iamVjdFsyXSA9IHZlYzMobm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueik7CiAgbWF0MyBvYmplY3RUb1RhbmdlbnQgPSB0cmFuc3Bvc2UodGFuZ2VudFRvT2JqZWN0KTsKICB2ZWMzIGludGVuc2lmaWNhdG9yID0gdmVjMyh1X25vaXNlSW50ZW5zaXR5LCB1X25vaXNlSW50ZW5zaXR5LCAxLjApOwogIHZlYzMgdGFuZ2VudFBvcyA9IG9iamVjdFRvVGFuZ2VudCAqIG5vaXNlUG9zOwogIHZlYzMgZ3JhZGllbnQgPSB2ZWMzKDAuMCk7CiAgZmxvYXQgbm9pc2VPdXQgPSBzbm9pc2UodGFuZ2VudFBvcyAqIG5vaXNlU2NhbGUsIGdyYWRpZW50KTsKICB2ZWMzIHRhbmdlbnRTcGFjZU5vcm1hbCA9IG5vcm1hbGl6ZShpbnRlbnNpZmljYXRvciAqIHZlYzMoZ3JhZGllbnQueHksIDEuMCkpOwogIG91dE5vcm1hbCA9IHRhbmdlbnRUb09iamVjdCAqIHRhbmdlbnRTcGFjZU5vcm1hbDsKICBvdXRDb2xvck11bHQgPSB2ZWM0KHZlYzMoMS4wICsgbm9pc2VPdXQgKiBjb2xvck5vaXNlQW1vdW50KSwgMS4wKTsKfQp2b2lkIGV2YWx1YXRlUEJSTGlnaHQoCiAgdmVjMyBtYXRlcmlhbENvbG9yLAogIHZlYzMgbGlnaHRDb2xvciwKICBmbG9hdCBuRG90TCwKICBmbG9hdCBuRG90ViwKICBmbG9hdCBuRG90SCwKICBmbG9hdCB2RG90SCwKICBmbG9hdCBsRG90SCwKICBpbm91dCB2ZWMzIGRpZmZ1c2VPdXQsCiAgaW5vdXQgdmVjMyBzcGVjdWxhck91dCwKICBpbm91dCB2ZWMzIGRlYnVnLAogIGZsb2F0IHNwZWNBbW91bnQpIHsKICAgIHZlYzMgZGlmZnVzZSA9IElOVl9QSSAqIG5Eb3RMICogbGlnaHRDb2xvcjsKICAgIHZlYzMgZCA9IHZlYzMoR0dYKG5Eb3RILCB1X3JvdWdobmVzcyAqIHVfcm91Z2huZXNzKSk7CiAgICB2ZWMzIGcgPSB2ZWMzKENUX0dlb0F0dGVuKG5Eb3RWLCBuRG90SCwgdkRvdEgsIG5Eb3RMLCBsRG90SCkpOwogICAgdmVjMyBmMCA9IHZlYzMoYWJzKCgxLjAgLSBfUmVmcmFjdGl2ZUluZGV4KSAvICgxLjAgKyBfUmVmcmFjdGl2ZUluZGV4KSkpOwogICAgZjAgPSBmMCAqIGYwOwogICAgZjAgPSBtaXgoZjAsIG1hdGVyaWFsQ29sb3IsIHVfbWV0YWxsaWMpOwogICAgdmVjMyBmID0gZXZhbHVhdGVGcmVzbmVsU2NobGljayh2RG90SCwgZjApOwogICAgZGlmZnVzZU91dCA9IGRpZmZ1c2VPdXQgKyAoMS4wIC0gc2F0dXJhdGUoZikpICogKDEuMCAtIHVfbWV0YWxsaWMpICogbGlnaHRDb2xvciAqIGRpZmZ1c2U7CiAgICBzcGVjdWxhck91dCA9IHNwZWN1bGFyT3V0ICsgc3BlY0Ftb3VudCAqIGxpZ2h0Q29sb3IgKiBzYXR1cmF0ZSgoZCAqIGcgKiBmKSAvIHNhdHVyYXRlKDQuMCAqIHNhdHVyYXRlKG5Eb3RIKSAqIG5Eb3RWKSk7CiAgICBkZWJ1ZyA9IHNhdHVyYXRlKGcpOwp9CnZvaWQgc2V0UGFyYW1zKHZlYzMgd29ybGRQb3NpdGlvbiwKICAgIGlub3V0IHZlYzMgbm9ybWFsLAogICAgaW5vdXQgdmVjMyB2aWV3LAogICAgaW5vdXQgZmxvYXQgbkRvdFYpIHsKICBub3JtYWwgPSBub3JtYWxpemUobm9ybWFsKTsKICB2aWV3ID0gbm9ybWFsaXplKGNhbWVyYVBvc2l0aW9uIC0gd29ybGRQb3NpdGlvbik7CiAgbkRvdFYgPSBzYXR1cmF0ZShkb3Qobm9ybWFsLCB2aWV3KSk7Cn0Kdm9pZCBzZXRMaWdodFBhcmFtcyh2ZWMzIGxpZ2h0UG9zaXRpb24sCiAgICB2ZWMzIHdvcmxkUG9zaXRpb24sCiAgICB2ZWMzIFYsCiAgICB2ZWMzIE4sCiAgICBpbm91dCB2ZWMzIEwsCiAgICBpbm91dCB2ZWMzIEgsCiAgICBpbm91dCBmbG9hdCBuRG90TCwKICAgIGlub3V0IGZsb2F0IG5Eb3RILAogICAgaW5vdXQgZmxvYXQgdkRvdEgsCiAgICBpbm91dCBmbG9hdCBsRG90SCkgewogIEwgPSBub3JtYWxpemUobGlnaHRQb3NpdGlvbiAtIHdvcmxkUG9zaXRpb24pOwogIEggPSBub3JtYWxpemUoTCArIFYpOwogIG5Eb3RMID0gc2F0dXJhdGUoZG90KE4sIEwpKTsKICBuRG90SCA9IHNhdHVyYXRlKGRvdChOLCBIKSk7CiAgdkRvdEggPSBzYXR1cmF0ZShkb3QoViwgSCkpOwogIGxEb3RIID0gc2F0dXJhdGUoZG90KEwsIEgpKTsKfQp2b2lkIG1haW4oKSB7CiAgdmVjMyBtYXRlcmlhbENvbG9yID0gdV9jb2xvcjsKICB2ZWM0IG91dENvbG9yTXVsdDsKICB2ZWMzIG5vcm1hbGlzZWROb3JtYWwgPSB2X25vcm1hbDsKICB2ZWMzIG5vcm1hbGlzZWRWaWV3OwogIGZsb2F0IG5Eb3RWOwogIGdlbmVyYXRlUGFwZXJjcmFmdENvbG9yTm9ybWFsKHZfbm9ybWFsLCB2X3RhbmdlbnQsIHZfYmlub3JtYWwsIHZfcG9zaXRpb24sIG91dENvbG9yTXVsdCwgbm9ybWFsaXNlZE5vcm1hbCk7CiAgc2V0UGFyYW1zKHZfcG9zaXRpb24sIG5vcm1hbGlzZWROb3JtYWwsIG5vcm1hbGlzZWRWaWV3LCBuRG90Vik7CiAgdmVjMyBub3JtYWxpc2VkTGlnaHQ7CiAgdmVjMyBub3JtYWxpc2VkSGFsZjsKICBmbG9hdCBuRG90TDsKICBmbG9hdCBuRG90SDsKICBmbG9hdCB2RG90SDsKICBmbG9hdCBsRG90SDsKICBzZXRMaWdodFBhcmFtcyh1X2xpZ2h0MFBvcywgdl9wb3NpdGlvbiwgbm9ybWFsaXNlZFZpZXcsIG5vcm1hbGlzZWROb3JtYWwsCiAgICAgIG5vcm1hbGlzZWRMaWdodCwgbm9ybWFsaXNlZEhhbGYsIG5Eb3RMLCBuRG90SCwgdkRvdEgsIGxEb3RIKTsKICB2ZWMzIGRpZmZ1c2UgPSB2ZWMzKDAuMCwgMC4wLCAwLjApOwogIHZlYzMgc3BlY3VsYXIgPSB2ZWMzKDAuMCwgMC4wLCAwLjApOwogIHZlYzMgZGVidWcgPSB2ZWMzKDAuMCwgMC4wLCAwLjApOwogIGV2YWx1YXRlUEJSTGlnaHQobWF0ZXJpYWxDb2xvciAqIG91dENvbG9yTXVsdC5yZ2IsIHVfbGlnaHQwQ29sb3IsIG5Eb3RMLCBuRG90ViwgbkRvdEgsIHZEb3RILCBsRG90SCwgZGlmZnVzZSwgc3BlY3VsYXIsIGRlYnVnLCAxLjApOwogIHZlYzMgYW1iaWVudCA9ICgxLjAgLSB1X21ldGFsbGljKSAqIG1hdGVyaWFsQ29sb3IgKiBvdXRDb2xvck11bHQucmdiICogMC4wOwogIHNldExpZ2h0UGFyYW1zKHVfbGlnaHQxUG9zLCB2X3Bvc2l0aW9uLCBub3JtYWxpc2VkVmlldywgbm9ybWFsaXNlZE5vcm1hbCwKICAgICAgbm9ybWFsaXNlZExpZ2h0LCBub3JtYWxpc2VkSGFsZiwgbkRvdEwsIG5Eb3RILCB2RG90SCwgbERvdEgpOwogIGV2YWx1YXRlUEJSTGlnaHQobWF0ZXJpYWxDb2xvciAqIG91dENvbG9yTXVsdC5yZ2IsIHVfbGlnaHQxQ29sb3IsIG5Eb3RMLCBuRG90ViwgbkRvdEgsIHZEb3RILCBsRG90SCwgZGlmZnVzZSwgc3BlY3VsYXIsIGRlYnVnLCAxLjApOwogIHZlYzMgUiA9IC1yZWZsZWN0KG5vcm1hbGlzZWRWaWV3LCBub3JtYWxpc2VkTm9ybWFsKTsKICBzZXRMaWdodFBhcmFtcyh2X3Bvc2l0aW9uICsgUiwgdl9wb3NpdGlvbiwgbm9ybWFsaXNlZFZpZXcsIG5vcm1hbGlzZWROb3JtYWwsCiAgICAgIG5vcm1hbGlzZWRMaWdodCwgbm9ybWFsaXNlZEhhbGYsIG5Eb3RMLCBuRG90SCwgdkRvdEgsIGxEb3RIKTsKICAgICAgICB2ZWMzIGVudkNvbG9yID0gbWl4KG1hdGVyaWFsQ29sb3IsIHZlYzMoMS4wLCAxLjAsIDEuMCksIDAuNyk7CiAgZXZhbHVhdGVQQlJMaWdodChtYXRlcmlhbENvbG9yICogb3V0Q29sb3JNdWx0LnJnYiwgZW52Q29sb3IgKiBlbnZpcm9ubWVudFN0cmVuZ3RoLCBuRG90TCwgbkRvdFYsIG5Eb3RILCB2RG90SCwgbERvdEgsIGRpZmZ1c2UsIHNwZWN1bGFyLCBkZWJ1ZywgMC4yNSk7CiAgZ2xfRnJhZ0NvbG9yID0gdmVjNChzcGVjdWxhciArIGRpZmZ1c2UgKiBtYXRlcmlhbENvbG9yLCAxLjApOwp9Cg==";

	var vsBase64 = "data:text/plain;base64,dW5pZm9ybSBtYXQ0IHVfbW9kZWxWaWV3TWF0cml4Owp1bmlmb3JtIG1hdDQgdV9wcm9qZWN0aW9uTWF0cml4Owp1bmlmb3JtIG1hdDMgdV9ub3JtYWxNYXRyaXg7CmF0dHJpYnV0ZSB2ZWMzIGFfcG9zaXRpb247CmF0dHJpYnV0ZSB2ZWMzIGFfbm9ybWFsOwp2YXJ5aW5nIHZlYzMgdl9ub3JtYWw7CnZhcnlpbmcgdmVjMyB2X3Bvc2l0aW9uOwp2YXJ5aW5nIHZlYzMgdl9iaW5vcm1hbDsKdmFyeWluZyB2ZWMzIHZfdGFuZ2VudDsKdm9pZCBtYWluKCkgewogIHZlYzMgb2JqUG9zaXRpb24gPSBhX3Bvc2l0aW9uOwogIHZlYzQgd29ybGRQb3NpdGlvbiA9IHZlYzQob2JqUG9zaXRpb24sIDEuMCk7CiAgdl9ub3JtYWwgPSBhX25vcm1hbDsKICB2X3Bvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7CiAgdmVjMyBhcmJpdHJhcnlWZWN0b3IgPSBub3JtYWxpemUodmVjMygwLjQyLCAtMC4yMSwgMC4xNSkpOwogIHZlYzMgYWx0ZXJuYXRlQXJiaXRyYXJ5VmVjdG9yID0gbm9ybWFsaXplKHZlYzMoMC40MywgMS41LCAwLjE1KSk7CiAgdl90YW5nZW50ID0gbm9ybWFsaXplKGFicyhkb3Qodl9ub3JtYWwsIGFyYml0cmFyeVZlY3RvcikpIDwgMS4wID8gY3Jvc3Modl9ub3JtYWwsIGFyYml0cmFyeVZlY3RvcikgOiBjcm9zcyh2X25vcm1hbCwgYWx0ZXJuYXRlQXJiaXRyYXJ5VmVjdG9yKSk7CiAgdl9iaW5vcm1hbCA9IG5vcm1hbGl6ZShjcm9zcyh2X25vcm1hbCwgdl90YW5nZW50KSk7CiAgZ2xfUG9zaXRpb24gPSB1X3Byb2plY3Rpb25NYXRyaXggKiB1X21vZGVsVmlld01hdHJpeCAqIHZlYzQob2JqUG9zaXRpb24sIDEuMCk7Cn0K";

	function GBlockLoader () {

	  THREE.GLTFLoader.call(this);

	  var self = this;

	  this._parse = this.parse;
	  this.parse = function (data, path, onLoad, onError) {
	    // convert uint8 to json
	    var json = JSON.parse(convertUint8ArrayToString(data));
	    // use base64 shaders
	    Object.keys(json.shaders).forEach(function (key, i) {
	      if (key.indexOf('fragment') > -1) json.shaders[key].uri = fsBase64;
	      else if (key.indexOf('vertex') > -1) json.shaders[key].uri = vsBase64;
	    });
	    // convert json to uint8
	    var uint8array = new TextEncoder('utf-8').encode(JSON.stringify(json));
	    // parse data
	    self._parse.call(self, uint8array, path, onLoad, onError);
	  };

	}
	GBlockLoader.prototype = THREE.GLTFLoader.prototype;

	// aframe module

	AFRAME.registerComponent('gblock', {
	  schema: {type: 'asset'},

	  init: function () {
	    this.model = null;
	    this.loader = new GBlockLoader();
	  },

	  update: function () {
	    var self = this;
	    var el = this.el;
	    var src = this.data;

	    if (!src) { return; }

	    this.remove();

	    var id = src.split('/').pop();

	    // FIXME: Replace this with an official API URL once available
	    // This API call is only needed to obtain the official glTF URL of a google block model.
	    // The glTF itself is not being proxied and gets fetched from https://vr.google.com/downloads/* directly.
	    // https://github.com/archilogic-com/aframe-gblock/issues/1
	    // API server code: server/index.js
	    fetch('https://gblock.herokuapp.com/get-gltf-url/' + id).then(function (response) {

	      return response.text().then(function (text) {
	        if (!response.ok) throw new Error('ERROR: ' + response.status + ' "' + text + '"')

	        // load glTF model from original URL
	        var gltfUrl = text;

	        self.loader.load( gltfUrl, function gltfLoaded (gltfModel) {
	          self.model = gltfModel.scene || gltfModel.scenes[0];
	          // FIXME: adapt projection matrix in original shaders
	          self.model.traverse(function (child) {
	            if (child.material) child.material = new THREE.MeshPhongMaterial({ vertexColors: THREE.VertexColors });
	          });
	          self.model.animations = gltfModel.animations;
	          el.setObject3D('mesh', self.model);
	          el.emit('model-loaded', {format: 'gltf', model: self.model});
	        });

	      })
	    });

	  },

	  remove: function () {
	    if (!this.model) { return; }
	    this.el.removeObject3D('mesh');
	  }
	});

	// helpers

	// from https://github.com/mrdoob/three.js/blob/master/examples/js/loaders/GLTFLoader.js
	function convertUint8ArrayToString (array) {
	  if (window.TextDecoder !== undefined) {
	    return new TextDecoder().decode(array);
	  }
	  // Avoid the String.fromCharCode.apply(null, array) shortcut, which
	  // throws a "maximum call stack size exceeded" error for large arrays.
	  var s = '';
	  for (var i = 0, il = array.length; i < il; i++) {
	    s += String.fromCharCode(array[i]);
	  }
	  return s;
	}

}());
//# sourceMappingURL=gblock.js.map
